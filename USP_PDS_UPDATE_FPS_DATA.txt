
CREATE PROCEDURE [dbo].[USP_PDS_UPDATE_FPS_DATA]
(
  @P_ACTION             VARCHAR(10) = NULL,
  @P_INTFPSID           INT = NULL,
  @P_BANKID             INT = NULL,
  @P_BRANCHID           INT = NULL,
  @P_VCH_IFSCCODE       VARCHAR(50) = NULL,
  @P_VCH_ACCOUNTNUMBER  VARCHAR(100) = NULL,
  @P_VCHCHALLANNO  VARCHAR(100) = NULL,
  @P_VCHCHALLANDATE  date = NULL,
  @P_VCH_PHOTO          VARCHAR(200) = NULL,
  @P_VCHCHALLANDOC      VARCHAR(200) = NULL,
  @P_VCHCHALLANDOCR     VARCHAR(200) = NULL,
  @P_VCHCHALLANDOCW     VARCHAR(200) = NULL,
  @P_VCHCHALLANDOCK     VARCHAR(200) = NULL,
  @P_INTUPDATEDBY           INT = NULL,

  @P_MSGOUT             VARCHAR(MAX) NULL OUTPUT
)

AS

BEGIN
       DECLARE @REFNUMBER   VARCHAR(20) = NULL

	   SET @REFNUMBER = (SELECT VCHREFERENCENO FROM M_PDS_FPS_LICENSEAPPLY WHERE INTFPSID=@P_INTFPSID )

               IF @P_ACTION = 'UM'

			   BEGIN

					UPDATE M 
					SET M.INTBANKID = @P_BANKID,
					M.INTBRANCHID = @P_BRANCHID,
					M.VCHIFSCCODE = @P_VCH_IFSCCODE,
					M.VCHACCOUNTNUMBER = @P_VCH_ACCOUNTNUMBER,
					M.INTFPSEDITEDBY = @P_INTUPDATEDBY,
					M.DTMFPSEDITDATE = GETDATE()
					FROM M_PDS_FPS_LICENSEAPPLY M
					INNER JOIN T_PDS_FPS_LICENSEEDETAILS T
					ON M.INTFPSID = T.INTLICID
					INNER JOIN T_PDS_FPS_PAYMENT P
					ON M.VCHREFERENCENO = P.VCHREFERENCECODE 
					WHERE M.INTFPSID = @P_INTFPSID AND M.INTDELETEDFLAG = 0 AND T.INTDELETEDFLAG = 0
					SET @P_MSGOUT = '1'



					UPDATE T
					SET T.VCHAPPLICANTPHOTO = @P_VCH_PHOTO,
					T.INTFPSEDITEDBY = @P_INTUPDATEDBY,
					T.DTMFPSEDITDATE = GETDATE()
					FROM M_PDS_FPS_LICENSEAPPLY M
					INNER JOIN T_PDS_FPS_LICENSEEDETAILS T
					ON M.INTFPSID = T.INTLICID
					INNER JOIN T_PDS_FPS_PAYMENT P
					ON M.VCHREFERENCENO = P.VCHREFERENCECODE 
					WHERE T.INTLICID = @P_INTFPSID AND M.INTDELETEDFLAG = 0 AND T.INTDELETEDFLAG = 0
					SET @P_MSGOUT = '1'

					UPDATE P
					SET
					P.VCHCHALLANDOC = @P_VCHCHALLANDOC,
					P.INTFPSEDITEDBY = @P_INTUPDATEDBY,
					P.DTMFPSEDITDATE = GETDATE(),
					--P.VCHCHALLANDOCR = @P_VCHCHALLANDOCR,
					--P.VCHCHALLANDOCW = @P_VCHCHALLANDOCW,
					--P.VCHCHALLANDOCK = @P_VCHCHALLANDOCK
					p.VCHCHALLAN=@P_VCHCHALLANNO,
					p.DTMCHALLAN=@P_VCHCHALLANDATE
					FROM M_PDS_FPS_LICENSEAPPLY M
					INNER JOIN T_PDS_FPS_LICENSEEDETAILS T
					ON M.INTFPSID = T.INTLICID
					INNER JOIN T_PDS_FPS_PAYMENT P
					ON M.VCHREFERENCENO = P.VCHREFERENCECODE 
					WHERE P.VCHREFERENCECODE = @REFNUMBER AND M.INTDELETEDFLAG = 0 AND T.INTDELETEDFLAG = 0
					SET @P_MSGOUT = '1'
			   END
			   else
					begin
					SET @P_MSGOUT='0'  
					end
              
 
END